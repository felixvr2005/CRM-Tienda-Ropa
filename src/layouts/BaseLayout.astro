---
/**
 * BaseLayout - Shell HTML común
 * Incluye meta tags, fuentes y estilos globales
 */
interface Props {
  title: string;
  description?: string;
  image?: string;
}

const { 
  title, 
  description = 'Moda premium masculina. Descubre las últimas tendencias en ropa y accesorios.',
  image = '/images/og-image.jpg'
} = Astro.props;

// Manejar URL canónica de forma segura
const siteUrl = Astro.site || new URL('http://localhost:4321');
const canonicalURL = new URL(Astro.url.pathname, siteUrl);
---

<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content={Astro.generator} />
  
  <!-- SEO -->
  <title>{title} | FASHION STORE</title>
  <meta name="description" content={description} />
  <link rel="canonical" href={canonicalURL} />
  
  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={image} />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={image} />
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
</head>
<body class="font-sans text-primary-900 antialiased">
  <!-- Skip link: mejora accesibilidad para usuarios de teclado/lector de pantalla -->
  <a href="#main-content" class="skip-link" style="position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden" onfocus="this.style.left='1rem';this.style.top='1rem';this.style.width='auto';this.style.height='auto'" onblur="this.style.left='-999px'">Ir al contenido</a>
  <div id="main-content" tabindex="-1" aria-hidden="false"></div>
  <slot />
</body>
</html>

<script is:inline>
  // Inicializar manejo de CSRF para formularios POST inmediatamente
  function initFormHandler() {
    document.addEventListener('submit', function(e) {
      const form = e.target;
      
      // Interceptar formularios POST que NO sean a APIs
      if (form.method && form.method.toUpperCase() === 'POST' && !form.action?.includes('/api/')) {
        e.preventDefault();
        
        const formData = new FormData(form);
        const data = {};
        
        // Convertir FormData a objeto
        for (const [key, value] of formData.entries()) {
          data[key] = value;
        }
        
        console.log('[CSRF] Intercepting POST to:', form.action || window.location.pathname);
        
        fetch(form.action || window.location.pathname, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: JSON.stringify(data)
        }).then(response => {
          if (response.ok) {
            window.location.reload();
          } else {
            alert('Error: ' + response.statusText);
          }
        }).catch(error => {
          alert('Error: ' + error.message);
        });
      }
    }, true);
  }
  
  // Ejecutar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFormHandler);
  } else {
    initFormHandler();
  }
</script>

<style is:global>
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #f5f5f5;
  }
  ::-webkit-scrollbar-thumb {
    background: #d4d4d4;
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #a3a3a3;
  }
  
  /* Selection */
  ::selection {
    background: #000;
    color: #fff;
  }
  
  /* Focus outline */
  :focus-visible {
    outline: 2px solid #000;
    outline-offset: 2px;
  }
</style>
