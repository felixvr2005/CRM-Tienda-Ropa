---
import { supabaseAdmin } from '@lib/supabase';
const { id } = Astro.params;

let debugResult = {};
try {
  const { data, error } = await supabaseAdmin
    .from('return_requests')
    .select('*, orders(customer_id, customer_email, order_number), return_request_items(*), credit_notes(*)')
    .eq('id', id)
    .single();

  debugResult = { data, error };
} catch (err: any) {
  debugResult = { error: err?.message || String(err) };
}
---
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Devolución - {id}</title>
    <style>body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:20px;background:#f7fafc;color:#111}pre{background:#fff;padding:12px;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.06);overflow:auto}</style>
  </head>
  <body>
    <h1>Debug Devolución (server-side)</h1>
    <p>ID: <strong>{id}</strong></p>
    <p>Resultado de la consulta usando <code>supabaseAdmin</code> en el servidor:</p>
    <pre>{JSON.stringify(debugResult, null, 2)}</pre>
  </body>
</html>