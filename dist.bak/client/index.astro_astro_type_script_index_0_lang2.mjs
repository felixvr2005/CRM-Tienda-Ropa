import{$ as E,d as x}from"./cart.DEWmPhv4.mjs";const c=t=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(t),u=E.get(),r=x.get();u.length===0&&(window.location.href="/carrito");const g=document.getElementById("cartSummary");g&&u.length>0&&(g.innerHTML=u.map(t=>`
      <div class="flex gap-3">
        <div class="w-16 h-20 bg-primary-100 flex-shrink-0 relative">
          ${t.image?`<img src="${t.image}" alt="${t.name}" class="w-full h-full object-cover" />`:""}
          <span class="absolute -top-2 -right-2 w-5 h-5 bg-primary-900 text-white text-xs rounded-full flex items-center justify-center">${t.quantity}</span>
        </div>
        <div class="flex-1">
          <p class="text-sm font-medium truncate">${t.name}</p>
          <p class="text-xs text-primary-500">${t.color} / ${t.size}</p>
          <p class="text-sm font-medium mt-1">${c(t.price*t.quantity)}</p>
        </div>
      </div>
    `).join(""));let a=4.95,d=0,v=null;const m=()=>{const t=document.getElementById("subtotal"),e=document.getElementById("shippingCost"),o=document.getElementById("discount"),s=document.getElementById("discountRow"),n=document.getElementById("total");if(t&&(t.textContent=c(r)),r>=50){a=0;const p=document.getElementById("standardPrice");p&&(p.textContent="Gratis")}e&&(e.textContent=a>0?c(a):"Gratis"),d>0&&s&&o&&(s.classList.remove("hidden"),o.textContent=`-${c(d)}`);const f=r+a-d;n&&(n.textContent=c(f))};m();document.querySelectorAll('input[name="shippingMethod"]').forEach(t=>{t.addEventListener("change",e=>{const o=e.target.value;o==="express"?a=9.95:o==="store"?a=0:a=r>=50?0:4.95,m()})});document.getElementById("applyCoupon")?.addEventListener("click",async()=>{const t=document.getElementById("couponCode"),e=document.getElementById("couponMessage"),o=t.value.trim().toUpperCase();if(!o)return;const n={WELCOME10:{type:"percentage",value:10,minPurchase:0},SAVE20:{type:"percentage",value:20,minPurchase:50},ENVIOGRATIS:{type:"shipping",value:0,minPurchase:0}}[o];if(e){if(!n){e.textContent="Cupón no válido",e.className="text-xs mt-2 text-red-600",e.classList.remove("hidden");return}if(r<n.minPurchase){e.textContent=`Mínimo de compra: ${c(n.minPurchase)}`,e.className="text-xs mt-2 text-red-600",e.classList.remove("hidden");return}v={code:o,...n},n.type==="percentage"?(d=r*(n.value/100),e.textContent=`¡${n.value}% de descuento aplicado!`):n.type==="shipping"&&(a=0,e.textContent="¡Envío gratis aplicado!"),e.className="text-xs mt-2 text-green-600",e.classList.remove("hidden"),t.disabled=!0,m()}});const y=document.getElementById("savedAddress");y?.addEventListener("change",()=>{const t=y.value;if(t)try{const e=JSON.parse(t),o=e.name?.split(" ")||[];document.getElementById("firstName").value=o[0]||"",document.getElementById("lastName").value=o.slice(1).join(" ")||"",document.getElementById("street").value=e.street||"",document.getElementById("street2").value=e.street2||"",document.getElementById("postalCode").value=e.postal_code||"",document.getElementById("city").value=e.city||"",document.getElementById("province").value=e.province||"",document.getElementById("country").value=e.country||"España",document.getElementById("phone").value=e.phone||""}catch(e){console.error("Error parsing address",e)}});const h=document.getElementById("checkoutForm"),i=document.getElementById("submitBtn"),l=document.getElementById("errorMessage");h?.addEventListener("submit",async t=>{t.preventDefault(),i.disabled=!0,i.textContent="PROCESANDO...",l?.classList.add("hidden");const e=new FormData(h),o={email:e.get("email"),phone:e.get("phone"),shippingAddress:{name:`${e.get("firstName")} ${e.get("lastName")}`,street:e.get("street"),street2:e.get("street2"),city:e.get("city"),province:e.get("province"),postal_code:e.get("postalCode"),country:e.get("country"),phone:e.get("phone")},shippingMethod:e.get("shippingMethod"),paymentMethod:e.get("paymentMethod"),couponCode:v?.code,items:u.map(s=>({variantId:s.variantId,quantity:s.quantity,price:s.price})),subtotal:r,shippingCost:a,discount:d,total:r+a-d};try{const n=await(await fetch("/api/checkout/create-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();if(n.error)throw new Error(n.error);n.url&&(window.location.href=n.url)}catch(s){l&&(l.textContent=s.message||"Error al procesar el pedido",l.classList.remove("hidden")),i.disabled=!1,i.textContent="PAGAR AHORA"}});
