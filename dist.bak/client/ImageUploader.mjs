import{j as e}from"./jsx-runtime.D_zvdyIk.mjs";import{r as i}from"./index.Da02gyCa.mjs";function F({onUpload:n=()=>{},onRemove:g,existingImages:v=[],maxImages:l=10,folder:h="productos"}){const[a,c]=i.useState([]),[d,p]=i.useState(!1),[u,m]=i.useState(!1);i.useEffect(()=>{if(window.cloudinary){m(!0);return}const t=document.createElement("script");return t.src="https://upload-widget.cloudinary.com/global/all.js",t.async=!0,t.onload=()=>m(!0),document.body.appendChild(t),()=>{}},[]);const f=()=>{if(!u||!window.cloudinary){alert("El widget de carga aún no está listo. Por favor, espera un momento.");return}window.cloudinary.createUploadWidget({cloudName:"dwyksbbk0",uploadPreset:"tienda_productos",folder:h,sources:["local","url","camera"],multiple:!0,maxFiles:l-a.length,maxFileSize:1e7,clientAllowedFormats:["jpg","jpeg","png","webp"],cropping:!0,croppingAspectRatio:.8,showSkipCropButton:!0,styles:{palette:{window:"#FFFFFF",windowBorder:"#CBD5E1",tabIcon:"#3B82F6",menuIcons:"#64748B",textDark:"#1E293B",textLight:"#FFFFFF",link:"#3B82F6",action:"#F97316",inactiveTabIcon:"#94A3B8",error:"#EF4444",inProgress:"#3B82F6",complete:"#22C55E",sourceBg:"#F1F5F9"},fonts:{default:null,"'Inter', sans-serif":{url:"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap",active:!0}}}},(s,r)=>{if(s){console.error("Error en upload:",s);return}if(r.event==="success"){const o={public_id:r.info.public_id,secure_url:r.info.secure_url,width:r.info.width,height:r.info.height,format:r.info.format,bytes:r.info.bytes};c(x=>{const b=[...x,o];return n&&n([o]),window.handleImagesUpload&&window.handleImagesUpload([o]),b})}r.event==="close"&&n(a),r.event==="queues-end"&&p(!1),r.event==="queues-start"&&p(!0)}).open()},w=async t=>{if(confirm("¿Eliminar esta imagen?"))try{(await fetch("/api/admin/images",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({publicId:t})})).ok?(c(r=>r.filter(o=>o.public_id!==t)),g?.(t)):alert("Error al eliminar la imagen")}catch(s){console.error("Error:",s),alert("Error al eliminar la imagen")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.map((t,s)=>e.jsxs("div",{className:"relative group aspect-[4/5] rounded-lg overflow-hidden border border-gray-200",children:[e.jsx("img",{src:t.secure_url,alt:`Imagen ${s+1}`,className:"w-full h-full object-cover"}),s===0&&e.jsx("span",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"Principal"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>w(t.public_id),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded-full transition-colors",title:"Eliminar imagen",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})})]},t.public_id)),a.length<l&&e.jsx("button",{type:"button",onClick:f,disabled:d||!u,className:"aspect-[4/5] rounded-lg border-2 border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50 transition-colors flex flex-col items-center justify-center gap-2 text-gray-500 hover:text-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-8 w-8",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-sm",children:"Subiendo..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-sm font-medium",children:"Agregar imágenes"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[a.length,"/",l]})]})})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Arrastra las imágenes para reordenarlas. La primera imagen será la principal. Formatos: JPG, PNG, WebP. Máximo 10MB por imagen."})]})}export{F as default};
