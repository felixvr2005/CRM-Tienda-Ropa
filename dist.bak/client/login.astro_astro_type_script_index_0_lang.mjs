import{s as i}from"./supabase.yhGfYKD_.mjs";import"./index.uR775ZKJ.mjs";const r=document.getElementById("loginForm"),n=document.getElementById("errorMessage"),o=document.getElementById("successMessage"),g=document.getElementById("submitBtn"),h=document.getElementById("btnText"),p=document.getElementById("btnSpinner"),w=document.getElementById("togglePassword"),d=document.getElementById("password"),f=document.getElementById("eyeIcon");w?.addEventListener("click",()=>{const e=d.type==="password";d.type=e?"text":"password",f.innerHTML=e?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />'});function c(e){g.disabled=e,h.textContent=e?"Verificando...":"Iniciar sesión",p.classList.toggle("hidden",!e)}function k(e){n.textContent=e,n.classList.remove("hidden"),o.classList.add("hidden")}function E(e){o.textContent=e,o.classList.remove("hidden"),n.classList.add("hidden")}r.addEventListener("submit",async e=>{e.preventDefault(),n.classList.add("hidden"),o.classList.add("hidden");const a=new FormData(r),m=a.get("email"),l=a.get("password");c(!0);try{const{data:t,error:s}=await i.auth.signInWithPassword({email:m,password:l});if(s)throw new Error(s.message);if(!t.user)throw new Error("Usuario no encontrado");if(!(t.user.app_metadata?.role==="admin"||t.user.user_metadata?.role==="admin")){const{data:u}=await i.from("admin_users").select("id").eq("auth_user_id",t.user.id).eq("is_active",!0).single();if(!u)throw await i.auth.signOut(),new Error("No tienes permisos de administrador. Si eres cliente, usa el login de clientes.")}E("¡Bienvenido! Redirigiendo al panel..."),t.session&&(document.cookie=`sb-access-token=${t.session.access_token}; path=/; max-age=${3600*24*7}; SameSite=Lax`,document.cookie=`sb-refresh-token=${t.session.refresh_token}; path=/; max-age=${3600*24*30}; SameSite=Lax`),setTimeout(()=>{window.location.href="/admin"},1e3)}catch(t){let s=t.message;s==="Invalid login credentials"&&(s="Email o contraseña incorrectos"),k(s),c(!1)}});
