import{j as e}from"./jsx-runtime.D_zvdyIk.mjs";import{r as u,b as L}from"./index.Da02gyCa.mjs";import{a as I}from"./cart.DEWmPhv4.mjs";import{f as R,c as T}from"./utils.ryeeuhiT.mjs";function B({productId:h,variants:t,variantImages:y,productName:k,defaultImages:d,selectedColor:j,onColorChange:n}){const[w,C]=u.useState(null),[l,x]=u.useState(0),[m,a]=u.useState(d),p=j??w,i=n?s=>n(s):C;u.useEffect(()=>{console.log("ðŸ” ProductImageGallery Debug:"),console.log("Variants:",t),console.log("VariantImages object:",y),console.log("Number of variants:",t.length)},[t,y]);const N=u.useMemo(()=>{if(!t||t.length===0)return[];const s=new Map;t.forEach(g=>{if(g.color&&g.color.trim()){s.has(g.color)||s.set(g.color,{hex:g.color_hex||"#808080",stock:0});const f=s.get(g.color);f&&(f.stock=Math.max(f.stock,g.stock||0))}});const o=Array.from(s.entries()).map(([g,f])=>({name:g,hex:f.hex,stock:f.stock}));return console.log("Colors found:",o),o},[t]);u.useEffect(()=>{N.length>0&&!p&&(console.log("Auto-selecting first color:",N[0].name),i(N[0].name))},[N,p]),u.useEffect(()=>{if(!p){console.log("âš ï¸ No selectedColor");return}console.log("ðŸŽ¨ Color seleccionado:",p);const s=t.find(o=>o.color===p);if(console.log("Found variant:",s),s){console.log(`ðŸ“¸ Buscando imÃ¡genes para variant.id: ${s.id}`);const o=y[s.id];if(console.log("ImÃ¡genes encontradas:",o),o&&Array.isArray(o)&&o.length>0){const g=o.sort((f,b)=>f.is_primary?-1:b.is_primary?1:(f.sort_order||0)-(b.sort_order||0)).map(f=>f.image_url);console.log("âœ… ImÃ¡genes ordenadas:",g),a(g)}else console.log("âš ï¸ Sin imÃ¡genes para esta variante, usando default"),a(d)}else console.log("âŒ Variante no encontrada para color:",p),console.log("Available colors in variants:",t.map(o=>o.color));x(0)},[p,t,y,d]);const M=()=>{x(s=>s===0?m.length-1:s-1)},S=()=>{x(s=>s===m.length-1?0:s+1)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"relative w-full aspect-square bg-primary-50 rounded-lg overflow-hidden mb-4 group",children:[e.jsx("img",{src:m[l],alt:`${k} - ${p} - imagen ${l+1}`,className:"w-full h-full object-cover"}),m.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:M,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-primary-900 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Imagen anterior",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:S,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-primary-900 p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Siguiente imagen",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),m.length>1&&e.jsxs("div",{className:"absolute bottom-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:[l+1," / ",m.length]})]}),m.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-6",children:m.map((s,o)=>e.jsx("button",{onClick:()=>x(o),className:`aspect-square rounded-lg overflow-hidden transition-all ${o===l?"ring-2 ring-primary-900":"ring-1 ring-primary-200 hover:ring-primary-500"}`,"aria-label":`Ver imagen ${o+1}`,children:e.jsx("img",{src:s,alt:`Thumbnail ${o+1}`,className:"w-full h-full object-cover"})},o))}),m.length>0&&m[l]&&e.jsxs("p",{className:"text-xs text-primary-500 text-center",children:["Imagen ",l+1," de ",m.length]})]})}function q({productId:h,productName:t,productSlug:y,productPrice:k,productDiscount:d,productImage:j,variants:n,variantImages:w={},selectedColor:C,onColorChange:l}){const[x,m]=u.useState(null),[a,p]=u.useState(null),i=C??a,N=l?r=>l(r):p,[M,S]=u.useState(null),[s,o]=u.useState(!1),g=u.useMemo(()=>{const r=new Set;return n.forEach(c=>r.add(c.size)),Array.from(r)},[n]),f=u.useMemo(()=>{const r=new Map;return n.forEach(c=>{r.has(c.color)||r.set(c.color,c.color_hex||"#000000")}),Array.from(r.entries()).map(([c,v])=>({name:c,hex:v}))},[n]),b=u.useMemo(()=>!x||!i?null:n.find(r=>r.size===x&&r.color===i),[x,i,n]),P=u.useMemo(()=>{if(!i||!b)return j;const r=w[b.id];if(r&&r.length>0){const c=r.find(v=>v.is_primary);return c?c.image_url:r[0].image_url}return j},[i,b,w,j]),_=(r,c)=>{const v=n.find(E=>E.size===r&&E.color===c);return v&&v.stock>0},z=b?.stock??0,A=T(k,d),$=()=>{if(!x){S("Selecciona una talla");return}if(!i){S("Selecciona un color");return}if(!b||b.stock<=0){S("CombinaciÃ³n no disponible");return}o(!0),S(null),I({id:b.id,productId:h,variantId:b.id,name:t,slug:y,price:A,originalPrice:k,discount:d,image:P,size:x,color:i,maxStock:b.stock}),setTimeout(()=>{o(!1)},500)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("span",{className:"text-sm text-primary-500 uppercase tracking-wider",children:"Color"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(({name:r,hex:c})=>e.jsx("button",{onClick:()=>{N(r),S(null)},className:`w-8 h-8 rounded-full border-2 transition-all ${i===r?"border-primary-900 ring-1 ring-offset-1 ring-primary-900":"border-primary-200 hover:border-primary-400"}`,style:{backgroundColor:c},title:r,"aria-label":r},r))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm text-primary-500 uppercase tracking-wider",children:"Talla"}),e.jsx("button",{className:"text-xs text-primary-500 underline hover:text-primary-900",children:"GuÃ­a de tallas"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:g.map(r=>{const c=i?_(r,i):n.some(v=>v.size===r&&v.stock>0);return e.jsx("button",{onClick:()=>{c&&(m(r),S(null))},disabled:!c,className:`py-3 text-sm border transition-all ${x===r?"border-primary-900 bg-primary-900 text-white":c?"border-primary-300 hover:border-primary-900":"border-primary-200 text-primary-300 cursor-not-allowed line-through"}`,children:r},r)})})]}),b&&z>0&&z<=5&&e.jsxs("p",{className:"text-sm text-amber-600",children:["âš ï¸ Solo quedan ",z," unidades"]}),M&&e.jsx("p",{className:"text-sm text-red-600",children:M}),e.jsx("button",{onClick:$,disabled:s,className:`w-full py-4 text-sm tracking-widest uppercase font-medium transition-all ${s?"bg-green-600 text-white":"bg-primary-900 text-white hover:bg-primary-800"}`,children:s?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"AÃ±adido"]}):`AÃ±adir - ${R(A)}`}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-primary-200",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-primary-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),e.jsx("span",{children:"EnvÃ­o gratis a partir de 100â‚¬"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-primary-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"DevoluciÃ³n gratuita en 30 dÃ­as"})]})]})]})}function X(h,t){return h<160&&t<55?{size:"XS",confidence:95,explanation:"Basado en tu altura y peso, recomendamos talla XS para un ajuste perfecto."}:h<165&&t<65?{size:"S",confidence:90,explanation:"Con tu altura y peso, la talla S deberÃ­a quedarte cÃ³moda."}:h<175&&t<80?{size:"M",confidence:90,explanation:"La talla M es la mÃ¡s recomendada para tu complexiÃ³n."}:h<185&&t<95?{size:"L",confidence:90,explanation:"Basado en tu altura y peso, la talla L te quedarÃ¡ perfectamente."}:h<195&&t<110?{size:"XL",confidence:90,explanation:"Para tu complexiÃ³n, recomendamos la talla XL."}:{size:"XXL",confidence:85,explanation:"Recomendamos la talla XXL. Si tienes dudas, contÃ¡ctanos."}}function V(){const[h,t]=L.useState(""),[y,k]=L.useState(""),[d,j]=L.useState(null),[n,w]=L.useState(!1),[C,l]=L.useState(""),x=()=>{if(l(""),!h||!y){l("Por favor ingresa altura y peso");return}const a=Number(h),p=Number(y);if(a<140||a>220){l("Altura debe estar entre 140 y 220 cm");return}if(p<40||p>200){l("Peso debe estar entre 40 y 200 kg");return}const i=X(a,p);j(i)},m=a=>{window.dispatchEvent(new CustomEvent("sizeSelected",{detail:{size:a}})),w(!1)};return n?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-display font-medium",children:"Recomendador de Talla"}),e.jsx("button",{onClick:()=>{w(!1),j(null),t(""),k(""),l("")},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded",children:[e.jsx("p",{className:"text-sm text-primary-600 mb-2",children:"Te recomendamos:"}),e.jsx("p",{className:"text-4xl font-bold text-green-600 mb-2",children:d.size}),e.jsx("p",{className:"text-sm text-primary-700",children:d.explanation}),e.jsxs("p",{className:"text-xs text-primary-500 mt-2",children:["Confianza: ",d.confidence,"%"]})]}),e.jsx("p",{className:"text-xs text-primary-600",children:"ðŸ’¡ Esta es una recomendaciÃ³n basada en tu altura y peso. Si tienes dudas, consulta la tabla de medidas detallada."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>m(d.size),className:"w-full bg-green-600 text-white py-2 rounded font-medium hover:bg-green-700 transition-colors",children:["Seleccionar ",d.size]}),e.jsx("button",{onClick:()=>{j(null),t(""),k(""),l("")},className:"w-full border border-primary-300 text-primary-600 py-2 rounded font-medium hover:bg-primary-50 transition-colors",children:"Recalcular"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-primary-600",children:"CuÃ©ntanos tu altura y peso para recomendarte la talla perfecta."}),C&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 text-red-700 text-sm rounded",children:C}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-900 mb-1",children:"Altura (cm)"}),e.jsx("input",{type:"number",min:"140",max:"220",value:h,onChange:a=>t(a.target.value?Number(a.target.value):""),placeholder:"Ej: 175",className:"w-full px-3 py-2 border border-primary-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary-900 mb-1",children:"Peso (kg)"}),e.jsx("input",{type:"number",min:"40",max:"200",value:y,onChange:a=>k(a.target.value?Number(a.target.value):""),placeholder:"Ej: 75",className:"w-full px-3 py-2 border border-primary-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-600"})]}),e.jsx("button",{onClick:x,className:"w-full bg-primary-600 text-white py-2 rounded font-medium hover:bg-primary-700 transition-colors",children:"Obtener RecomendaciÃ³n"})]})]})}):e.jsx("button",{onClick:()=>w(!0),className:"mt-4 px-4 py-2 border border-primary-300 text-primary-600 text-sm hover:bg-primary-50 transition-colors rounded",children:"â“ Â¿CuÃ¡l es mi talla?"})}function D({productId:h,productName:t,productSlug:y,productPrice:k,productDiscount:d,productImage:j,variants:n,variantImages:w}){const[C,l]=u.useState(null),x=u.useMemo(()=>{const i=new Map;return n.forEach(N=>{i.has(N.color)||i.set(N.color,N.color_hex||"#000000")}),Array.from(i.entries()).map(([N,M])=>({name:N,hex:M}))},[n]),m=x.length>0?x[0].name:null,a=k/100,p=a*(1-d/100);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16",children:[e.jsx("div",{className:"lg:sticky lg:top-24 lg:self-start",children:e.jsx(B,{productId:h,variants:n,variantImages:w,productName:t,defaultImages:[j],selectedColor:C||m,onColorChange:l})}),e.jsxs("div",{className:"py-4",children:[e.jsx("h1",{className:"font-display text-3xl mb-4",children:t}),e.jsxs("div",{className:"flex items-baseline gap-3 mb-8",children:[e.jsxs("span",{className:"text-2xl font-bold text-primary-900",children:["â‚¬",p.toFixed(2)]}),d>0&&e.jsxs("span",{className:"text-lg text-primary-400 line-through",children:["â‚¬",a.toFixed(2)]})]}),e.jsx(q,{productId:h,productName:t,productSlug:y,productPrice:k,productDiscount:d,productImage:j,variants:n,variantImages:w,selectedColor:C,onColorChange:l}),e.jsx(V,{})]})]})}export{D as default};
