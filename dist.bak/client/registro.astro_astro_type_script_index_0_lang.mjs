import{s as y}from"./supabase.yhGfYKD_.mjs";import{m as B}from"./cart.DEWmPhv4.mjs";import"./index.uR775ZKJ.mjs";const p=document.getElementById("registerForm"),d=document.getElementById("errorMessage"),l=document.getElementById("successMessage"),M=document.getElementById("submitBtn"),P=document.getElementById("btnText"),C=document.getElementById("btnSpinner"),i=document.getElementById("password"),c=document.getElementById("confirmPassword"),k=document.getElementById("togglePassword"),T=document.getElementById("toggleConfirmPassword"),b=document.getElementById("strengthBar"),_=document.getElementById("strengthText"),a=document.getElementById("passwordMatch"),N=document.getElementById("eyeIcon1"),D=document.getElementById("eyeIcon2"),j='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />',z='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />';function L(e,t){const n=e.type==="password";e.type=n?"text":"password",t.innerHTML=n?z:j}k?.addEventListener("click",()=>L(i,N));T?.addEventListener("click",()=>L(c,D));function A(e){let t=0;e.length>=8&&t++,e.length>=12&&t++,/[a-z]/.test(e)&&/[A-Z]/.test(e)&&t++,/\d/.test(e)&&t++,/[^a-zA-Z0-9]/.test(e)&&t++;const n=[{text:"Muy débil",color:"bg-red-500"},{text:"Débil",color:"bg-orange-500"},{text:"Regular",color:"bg-yellow-500"},{text:"Buena",color:"bg-blue-500"},{text:"Muy fuerte",color:"bg-green-500"}],o=Math.min(t,n.length-1);return{strength:t,text:n[o].text,color:n[o].color}}i?.addEventListener("input",()=>{const{strength:e,text:t,color:n}=A(i.value),o=e/5*100;b.className=`h-full transition-all duration-300 ${n}`,b.style.width=`${o}%`,_.textContent=i.value?t:"Mínimo 8 caracteres",c.value&&v()});function v(){if(!c.value){a.classList.add("hidden");return}a.classList.remove("hidden"),i.value===c.value?(a.textContent="✓ Las contraseñas coinciden",a.className="mt-1 text-xs text-green-600"):(a.textContent="✗ Las contraseñas no coinciden",a.className="mt-1 text-xs text-red-600")}c?.addEventListener("input",v);function u(e){M.disabled=e,P.textContent=e?"Creando cuenta...":"Crear Cuenta",C.classList.toggle("hidden",!e)}function g(e){d.innerHTML=e,d.classList.remove("hidden"),l.classList.add("hidden")}function E(e){l.innerHTML=e,l.classList.remove("hidden"),d.classList.add("hidden")}p?.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(p),n=t.get("firstName"),o=t.get("lastName"),f=t.get("email"),m=t.get("password"),x=t.get("confirmPassword"),I=t.get("newsletter")==="on";if(m!==x){g("Las contraseñas no coinciden");return}if(m.length<8){g("La contraseña debe tener al menos 8 caracteres");return}d.classList.add("hidden"),l.classList.add("hidden"),u(!0);try{const{data:r,error:s}=await y.auth.signUp({email:f,password:m,options:{data:{first_name:n,last_name:o}}});if(s)throw new Error(s.message);if(r.user){const{data:h,error:w}=await y.from("customers").insert({auth_user_id:r.user.id,email:r.user.email,first_name:n,last_name:o||null,is_subscribed_newsletter:I}).select().single();if(w&&console.error("Error creating customer profile:",w),r.user.identities?.length===0){E(`
            <strong>¡Casi listo!</strong><br>
            Hemos enviado un email de confirmación a <strong>${f}</strong>.<br>
            Por favor, revisa tu bandeja de entrada (y spam).
          `),u(!1);return}h&&await B(h.id),E("¡Cuenta creada! Redirigiendo..."),setTimeout(()=>{window.location.href="/cuenta"},1500)}}catch(r){let s=r.message;s.includes("already registered")?s='Este email ya está registrado. <a href="/cuenta/login" class="underline font-medium">¿Quieres iniciar sesión?</a>':s.includes("Invalid email")?s="Por favor, introduce un email válido":s.includes("Password")&&(s="La contraseña debe tener al menos 8 caracteres"),g(s),u(!1)}});
