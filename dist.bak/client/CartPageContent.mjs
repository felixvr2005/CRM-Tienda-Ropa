import{j as e}from"./jsx-runtime.D_zvdyIk.mjs";import{u as w}from"./index.BGqd_My2.mjs";import{r as t}from"./index.Da02gyCa.mjs";import{s as k,r as S,u as N,c as P,g as T,$ as E}from"./cart.DEWmPhv4.mjs";import{f as l}from"./utils.ryeeuhiT.mjs";function L({onCouponApplied:a,onCouponRemoved:j}){const[n,g]=t.useState(""),[m,i]=t.useState(null),[y,v]=t.useState(0),[u,p]=t.useState(!1),[f,c]=t.useState(""),[o,d]=t.useState(""),x=async h=>{if(h.preventDefault(),!n.trim()){c("Ingresa un código de cupón");return}p(!0),c(""),d("");try{const s=await fetch("/api/coupons/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n.toUpperCase()})}),r=await s.json();if(!s.ok){c(r.error||"Cupón inválido");return}i(n.toUpperCase()),v(r.discount||0),d(`¡Cupón aplicado! Descuento: -${r.discount_percentage||0}%`),g(""),a?.(n.toUpperCase(),r.discount||0)}catch(s){console.error("Coupon validation error:",s),c("Error al validar el cupón")}finally{p(!1)}},b=()=>{i(null),v(0),g(""),c(""),d(""),j?.()};return e.jsxs("div",{className:"space-y-4",children:[m&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:m}),e.jsx("p",{className:"text-xs text-green-700",children:"Cupón aplicado correctamente"})]})]}),e.jsx("button",{onClick:b,className:"text-green-600 hover:text-green-900 transition-colors",title:"Remover cupón",children:"✕"})]})}),!m&&e.jsxs("form",{onSubmit:x,className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Código de cupón...",value:n,onChange:h=>{g(h.target.value),c("")},className:"flex-1 px-4 py-2 border border-primary-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-600 text-sm",disabled:u}),e.jsx("button",{type:"submit",disabled:u||!n.trim(),className:"px-6 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 disabled:bg-primary-300 disabled:cursor-not-allowed transition-colors",children:u?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Validando..."]}):"Aplicar"})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-red-700",children:["❌ ",f]})}),o&&!m&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-green-700",children:["✓ ",o]})})]})}function M(){const a=w(E),[j,n]=t.useState(!1),[g,m]=t.useState(""),[i,y]=t.useState(null),[v,u]=t.useState(""),[p,f]=t.useState(0);t.useEffect(()=>{if(a.length===0)return;k();const s=()=>{f(T())};s();const r=setInterval(s,1e3);return()=>clearInterval(r)},[a.length]);const c=s=>{const r=Math.floor(s/60),C=s%60;return`${r.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`},o=a.reduce((s,r)=>s+r.price*r.quantity,0),d=o>=100?0:5.95;let x=0;i&&i.discountType==="percentage"&&(x=o*i.discountPercentage/100);const b=o-x+d,h=async()=>{if(a.length!==0){n(!0);try{const r=await(await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:a,couponCode:i?.code||null,discountAmount:x})})).json();r.url?window.location.href=r.url:alert("Error al procesar el pago")}catch(s){console.error("Checkout error:",s),alert("Error al procesar el pago")}finally{n(!1)}}};return a.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("svg",{className:"w-20 h-20 mx-auto text-primary-300 mb-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h2",{className:"font-display text-2xl mb-4",children:"Tu cesta está vacía"}),e.jsx("p",{className:"text-primary-500 mb-8",children:"Descubre nuestra colección y añade tus prendas favoritas"}),e.jsx("a",{href:"/productos",className:"inline-block bg-primary-900 text-white px-8 py-3 text-sm tracking-widest uppercase hover:bg-primary-800 transition-colors",children:"Ver colección"})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12",children:[p>0&&e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:`flex items-center justify-center gap-2 py-3 px-4 rounded ${p<300?"bg-red-50 text-red-700 border border-red-200":"bg-amber-50 text-amber-700 border border-amber-200"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm",children:[e.jsx("strong",{children:"Stock reservado por:"})," ",c(p)]}),e.jsx("span",{className:"text-xs ml-2",children:p<300?"(¡Date prisa!)":"(El stock se liberará al expirar)"})]})}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"border-b border-primary-200 pb-4 mb-4 hidden md:grid grid-cols-12 gap-4 text-xs uppercase tracking-wider text-primary-500",children:[e.jsx("div",{className:"col-span-6",children:"Producto"}),e.jsx("div",{className:"col-span-2 text-center",children:"Cantidad"}),e.jsx("div",{className:"col-span-2 text-right",children:"Precio"}),e.jsx("div",{className:"col-span-2 text-right",children:"Total"})]}),e.jsx("div",{className:"space-y-6",children:a.map(s=>{const r=s.price*s.quantity;return e.jsxs("div",{className:"grid grid-cols-12 gap-4 py-4 border-b border-primary-100",children:[e.jsxs("div",{className:"col-span-12 md:col-span-6 flex gap-4",children:[e.jsx("a",{href:`/productos/${s.slug}`,className:"w-24 h-32 bg-primary-100 flex-shrink-0",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("a",{href:`/productos/${s.slug}`,className:"font-medium hover:underline block mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-primary-500 mb-2",children:["Talla: ",s.size," | Color: ",s.color]}),e.jsxs("div",{className:"md:hidden flex items-center gap-2 mb-2",children:[s.discount>0&&e.jsx("span",{className:"text-sm text-primary-400 line-through",children:l(s.originalPrice)}),e.jsx("span",{className:"text-sm font-medium",children:l(s.price)})]}),e.jsx("button",{onClick:async()=>await S(s.variantId),className:"text-xs text-primary-500 hover:text-red-600 underline",children:"Eliminar"})]})]}),e.jsx("div",{className:"col-span-6 md:col-span-2 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center border border-primary-300",children:[e.jsx("button",{onClick:async()=>await N(s.variantId,s.quantity-1),className:"w-8 h-8 flex items-center justify-center hover:bg-primary-100 transition-colors",disabled:s.quantity<=1,children:"−"}),e.jsx("span",{className:"w-10 text-center text-sm",children:s.quantity}),e.jsx("button",{onClick:async()=>await N(s.variantId,s.quantity+1),className:"w-8 h-8 flex items-center justify-center hover:bg-primary-100 transition-colors",children:"+"})]})}),e.jsx("div",{className:"hidden md:flex col-span-2 items-center justify-end",children:e.jsxs("div",{className:"text-right",children:[s.discount>0&&e.jsx("span",{className:"text-sm text-primary-400 line-through block",children:l(s.originalPrice)}),e.jsx("span",{className:"text-sm",children:l(s.price)})]})}),e.jsx("div",{className:"col-span-6 md:col-span-2 flex items-center justify-end",children:e.jsx("span",{className:"font-medium",children:l(r)})})]},`${s.id}-${s.size}-${s.color}`)})}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx("button",{onClick:async()=>await P(!0),className:"text-sm text-primary-500 hover:text-red-600",children:"Vaciar cesta"}),e.jsx("a",{href:"/productos",className:"text-sm underline hover:no-underline",children:"Continuar comprando"})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-primary-50 p-6 sticky top-24",children:[e.jsx("h2",{className:"font-display text-xl mb-6",children:"Resumen del pedido"}),e.jsx("div",{className:"mb-6",children:e.jsx(L,{onCouponApplied:(s,r)=>{y({code:s,discountPercentage:r/o*100}),u("")},onCouponRemoved:()=>{y(null),m("")}})}),e.jsxs("div",{className:"space-y-3 text-sm border-t border-primary-200 pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-primary-600",children:"Subtotal"}),e.jsx("span",{children:l(o)})]}),i&&e.jsxs("div",{className:"flex justify-between text-green-600 font-medium",children:[e.jsxs("span",{children:["Descuento (",i.discountPercentage,"%)"]}),e.jsxs("span",{children:["-",l(x)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-primary-600",children:"Envío"}),e.jsx("span",{children:d===0?"Gratis":l(d)})]}),d>0&&e.jsx("p",{className:"text-xs text-primary-500",children:"Envío gratis en pedidos superiores a 100€"}),e.jsxs("div",{className:"flex justify-between text-lg font-medium border-t border-primary-200 pt-3",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:l(b)})]}),e.jsx("p",{className:"text-xs text-primary-500",children:"IVA incluido"})]}),e.jsx("button",{onClick:h,disabled:j||a.length===0,className:"w-full bg-primary-900 text-white py-4 mt-6 text-sm tracking-widest uppercase hover:bg-primary-800 transition-colors disabled:bg-primary-400 disabled:cursor-not-allowed",children:j?"Procesando...":"Finalizar compra"}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-xs text-primary-500 mb-3",children:"Pago seguro con"}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("span",{className:"text-xs text-primary-400",children:"Visa"}),e.jsx("span",{className:"text-xs text-primary-400",children:"Mastercard"}),e.jsx("span",{className:"text-xs text-primary-400",children:"PayPal"})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-primary-200 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pago 100% seguro"}),e.jsx("p",{className:"text-xs text-primary-500",children:"Conexión SSL encriptada"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M16 15v-1a4 4 0 00-4-4H8m0 0l3 3m-3-3l3-3m9 14V5a2 2 0 00-2-2H6a2 2 0 00-2 2v16l4-2 4 2 4-2 4 2z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Devolución gratuita"}),e.jsx("p",{className:"text-xs text-primary-500",children:"30 días para devolver"})]})]})]})]})})]})}export{M as default};
