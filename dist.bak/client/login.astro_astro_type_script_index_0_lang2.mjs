import{s as o}from"./supabase.yhGfYKD_.mjs";import"./cart.DEWmPhv4.mjs";import"./index.uR775ZKJ.mjs";const d=document.getElementById("loginForm"),n=document.getElementById("errorMessage"),i=document.getElementById("successMessage"),w=document.getElementById("submitBtn"),f=document.getElementById("btnText"),k=document.getElementById("btnSpinner"),E=document.getElementById("togglePassword"),c=document.getElementById("password"),L=document.getElementById("eyeIcon");E?.addEventListener("click",()=>{const t=c.type==="password";c.type=t?"text":"password",L.innerHTML=t?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />'});function m(t){w.disabled=t,f.textContent=t?"Iniciando sesión...":"Iniciar Sesión",k.classList.toggle("hidden",!t)}function u(t){n.textContent=t,n.classList.remove("hidden"),i.classList.add("hidden")}function l(t){i.textContent=t,i.classList.remove("hidden"),n.classList.add("hidden")}d?.addEventListener("submit",async t=>{t.preventDefault();const a=new FormData(d),g=a.get("email"),p=a.get("password");n.classList.add("hidden"),i.classList.add("hidden"),m(!0);try{const{data:e,error:s}=await o.auth.signInWithPassword({email:g,password:p});if(console.log("Login response:",{data:e,error:s}),s)throw new Error(s.message);if(e.user&&e.session){if(console.log("User logged in:",e.user.email),e.user.app_metadata?.role==="admin"||e.user.user_metadata?.role==="admin"){l("Eres administrador. Redirigiendo al panel de admin..."),document.cookie=`sb-access-token=${e.session.access_token}; path=/; max-age=${3600*24*7}; SameSite=Lax`,document.cookie=`sb-refresh-token=${e.session.refresh_token}; path=/; max-age=${3600*24*30}; SameSite=Lax`,window.location.replace("/admin");return}document.cookie=`sb-access-token=${e.session.access_token}; path=/; max-age=${3600*24*7}; SameSite=Lax`,document.cookie=`sb-refresh-token=${e.session.refresh_token}; path=/; max-age=${3600*24*30}; SameSite=Lax`,console.log("Cookies guardadas, intentando crear/obtener perfil...");try{const{data:r}=await o.from("customers").select("id").eq("auth_user_id",e.user.id).single();r||await o.from("customers").insert({auth_user_id:e.user.id,email:e.user.email,first_name:e.user.user_metadata?.first_name||"Cliente",last_name:e.user.user_metadata?.last_name||""})}catch(r){console.error("Error con perfil de cliente:",r)}l("¡Bienvenido! Redirigiendo..."),console.log("Redirigiendo a inicio...");const h=new URLSearchParams(window.location.search).get("redirect")||"/";window.location.replace(h);return}else throw new Error("No se pudo iniciar sesión")}catch(e){console.error("Login error:",e);let s=e.message;s==="Invalid login credentials"?s="Email o contraseña incorrectos":s.includes("Email not confirmed")&&(s="Por favor, confirma tu email antes de iniciar sesión"),u(s),m(!1)}});document.getElementById("googleLogin")?.addEventListener("click",async()=>{const{error:t}=await o.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/cuenta/callback`}});t&&u(t.message)});
